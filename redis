version: "3.9"

services:
  redis:
    image: redis:7.2.11-alpine
    hostname: redis
    environment:
      - TZ=Asia/Tehran
    healthcheck:
      test: ["CMD-SHELL", "redis-cli ping | grep PONG"]
      interval: 20s
      timeout: 10s
      retries: 3
    ports:
      - "6379:6379"
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 1G
      replicas: 1
      restart_policy:
        condition: any
      placement:
        constraints:
          - node.hostname == ch-st-n1
    networks:
      - chabok

networks:
  chabok:
    name: chabok
    external: true
